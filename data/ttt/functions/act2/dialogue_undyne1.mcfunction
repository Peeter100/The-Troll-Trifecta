execute if entity @s[scores={dialoguetime=..88}] run scoreboard players add @s dialoguetime 1
execute if entity @s[scores={dialoguetime=89}] if entity @a[team=p,scores={x=..-51,z=90..},nbt={Inventory:[{tag:{hoverwand:1b}}]}] run scoreboard players add @s dialoguetime 1
execute if entity @s[scores={dialoguetime=90..358}] run scoreboard players add @s dialoguetime 1
execute if entity @s[scores={dialoguetime=359..361}] unless entity @a[team=p,scores={x=-54..-51,z=90..95},nbt={Inventory:[{tag:{hoverwand:1b}}]}] run scoreboard players add @s dialoguetime 1

execute if entity @s[scores={dialoguetime=100..}] run tag @a[nbt={Inventory:[{tag:{hoverwand:1b}}]}] add importantund
execute if entity @s[scores={dialoguetime=100..}] run tag @a[nbt=!{Inventory:[{tag:{hoverwand:1b}}]}] remove importantund

execute if entity @s[scores={dialoguetime=1}] run tellraw @a [{"text":"<"},{"text":"Undyne","color":"#03739C"},{"text":"> "},{"text":"Grillby","color":"#FF4D00"},{"text":" isn't here, punk.","color":"#03739C"}]
execute if entity @s[scores={dialoguetime=1}] as @e[type=armor_stand,tag=undhead] at @s run playsound custom.act2.undyne.speech master @a ~ ~ ~ 1000
execute if entity @s[scores={dialoguetime=50}] run stopsound @a master custom.act2.undyne.speech
execute if entity @s[scores={dialoguetime=60}] run tellraw @a [{"text":"<"},{"text":"Undyne","color":"#03739C"},{"text":"> "},{"text":"What are you looking for?","color":"#03739C"}]
execute if entity @s[scores={dialoguetime=60}] as @e[type=armor_stand,tag=undhead] at @s run playsound custom.act2.undyne.speech master @a ~ ~ ~ 1000

execute if entity @s[scores={dialoguetime=95}] run stopsound @a master custom.act2.undyne.speech
execute if entity @s[scores={dialoguetime=100}] run tellraw @a [{"text":"<"},{"text":"Undyne","color":"#03739C"},{"text":"> "},{"text":"Wait-","color":"#03739C"}]
execute if entity @s[scores={dialoguetime=100}] as @e[type=armor_stand,tag=undhead] at @s run playsound custom.act2.undyne.speech master @a ~ ~ ~ 1000
execute if entity @s[scores={dialoguetime=102}] run stopsound @a master custom.act2.undyne.speech
execute if entity @s[scores={dialoguetime=110}] run tellraw @a [{"text":"<"},{"text":"Undyne","color":"#03739C"},{"text":"> "},{"text":"Is that a ","color":"#03739C"},{"text":"HOVER WAND","color":"light_purple"},{"text":"?","color":"#03739C"}]
execute if entity @s[scores={dialoguetime=110}] as @e[type=armor_stand,tag=undhead] at @s run playsound custom.act2.undyne.speech master @a ~ ~ ~ 1000
execute if entity @s[scores={dialoguetime=160}] run stopsound @a master custom.act2.undyne.speech

#execute if entity @s[scores={dialoguetime=168}] as @e[type=armor_stand,tag=undhead] run function ttt:npc_stop_looking
execute if entity @s[scores={dialoguetime=170}] run tp @e[tag=undyne] -52 31 91
execute if entity @s[scores={dialoguetime=170}] run data merge entity @e[tag=undhead2,limit=1] {ArmorItems:[{},{},{},{id:"minecraft:bone",Count:1b,tag:{CustomModelData:71}}]}
execute if entity @s[scores={dialoguetime=170}] run data merge entity @e[tag=undbody1,limit=1] {HandItems:[{id:"minecraft:bone",Count:1b,tag:{CustomModelData:72}},{}],ArmorItems:[{},{},{},{}]}
execute if entity @s[scores={dialoguetime=170}] run kill @e[type=armor_stand,tag=stopphase2]
execute if entity @s[scores={dialoguetime=170}] run tag @e[type=armor_stand,tag=undhead2] add namednpc
execute if entity @s[scores={dialoguetime=170}] run tag @e[type=armor_stand,tag=undhead2] add undhead
execute if entity @s[scores={dialoguetime=167}] run summon villager -52 25 91 {NoGravity:1b,Silent:1b,Invulnerable:1b,CustomNameVisible:0b,PersistenceRequired:1b,NoAI:1b,CanPickUpLoot:0b,Health:100f,Tags:["undyne","undyneshop","forkill"],CustomName:'{"text":"Undyne","color":"#03739C","italic":false}',ActiveEffects:[{Id:14,Amplifier:0b,Duration:999999,ShowParticles:0b}],Attributes:[{Name:generic.max_health,Base:100},{Name:generic.movement_speed,Base:0.00}],VillagerData:{level:99,profession:"minecraft:nitwit",type:"minecraft:snow"},Offers:{Recipes:[{rewardExp:0b,maxUses:1,uses:0,buy:{id:"minecraft:stick",Count:1b,tag:{display:{Name:'{"text":"Hold-Trigger Hover Wand","color":"light_purple","italic":false}',Lore:['{"text":"While holding this wand, you will not be affected","color":"gray","italic":false}','[{"text":"by ","color":"gray","italic":false},{"text":"gravity","color":"yellow"},{"text":" as long as you have enough "},{"text":"energy","color":"light_purple"},{"text":"."}]','{"text":"Energy can be restored by standing","color":"gray","italic":false}','[{"text":"on the ground while ","color":"gray","italic":false},{"text":"NOT","color":"red"},{"text":" holding the wand."}]','{"text":" "}','{"text":"TIP: Switch to the wand immediately after","color":"red","italic":false}','{"text":"jumping to jump slightly higher!","color":"red","italic":false}']},HideFlags:3,CustomModelData:1,hoverwand:1b,Enchantments:[{}]}},sell:{id:"minecraft:gold_ingot",Count:10b,tag:{display:{Name:'{"text":"Gold Ingot","color":"gold","italic":false}'},undgold:1b}}},{rewardExp:0b,maxUses:1,uses:0,buy:{id:"minecraft:gold_ingot",Count:8b,tag:{display:{Name:'{"text":"Gold Ingot","color":"gold","italic":false}'},undgold:1b}},sell:{id:"minecraft:netherite_sword",Count:1b,tag:{display:{Name:'{"text":"Reinforced Obamium Sword","color":"gold","italic":false}',Lore:['[{"text":"Base Attack Damage: ","color":"gray","italic":false},{"text":"+10","color":"red"}]','{"text":" "}','{"text":"Sharpness V","color":"blue","italic":false}','[{"text":"Adds ","color":"gray","italic":false},{"text":"+0.5","color":"red"},{"text":" base damage and "},{"text":"+0.5","color":"red"}]','{"text":"damage every enchantment level.","color":"gray","italic":false}','{"text":" "}','{"text":"Unbreaking X","color":"blue","italic":false}','[{"text":"Makes the tool on average ","color":"gray","italic":false},{"text":"+100%","color":"green"}]','{"text":"more durable per enchantment level.","color":"gray","italic":false}']},HideFlags:39,Unbreakable:1b,CustomModelData:1,obamasword:1b,unditem:1b,Enchantments:[{}]}}},{rewardExp:0b,maxUses:1,uses:0,buy:{id:"minecraft:gold_ingot",Count:9b,tag:{display:{Name:'{"text":"Gold Ingot","color":"gold","italic":false}'},undgold:1b}},sell:{id:"minecraft:bow",Count:1b,tag:{display:{Name:'{"text":"Flame Hurricane Bow","color":"gold","italic":false}',Lore:['[{"text":"Base Attack Damage: ","color":"gray","italic":false},{"text":"+7.5","color":"red"}]','{"text":" "}','{"text":"Power V","color":"blue","italic":false}','[{"text":"Increases damage by ","color":"gray","italic":false},{"text":"+25%","color":"red","italic":false},{"text":" and"}]','[{"text":"+25%","color":"red","italic":false},{"text":" damage per enchantment level.","color":"gray"}]','{"text":" "}','{"text":"Flame X","color":"blue","italic":false}','[{"text":"Deals ","color":"gray","italic":false},{"text":"1","color":"gold"},{"text":" fire damage per second"}]','[{"text":"for ","color":"gray","italic":false},{"text":"5s","color":"yellow"},{"text":" for every enchantment level."}]','[{"text":"Can also be used to ","color":"gray","italic":false},{"text":"ignite blocks","color":"gold"}]','{"text":"from a distance.","color":"gray","italic":false}','{"text":" "}','{"text":"Infinity","color":"blue","italic":false}','{"text":"The bow can shoot infinitely as long","color":"gray","italic":false}','{"text":"as there is 1 arrow in your inventory.","color":"gray","italic":false}']},HideFlags:5,Unbreakable:1b,CustomModelData:1,unditem:1b,flamebow:1b,Enchantments:[{id:"minecraft:flame",lvl:1},{id:"minecraft:infinity",lvl:1}]}}},{rewardExp:0b,maxUses:2,uses:0,buy:{id:"minecraft:gold_ingot",Count:5b,tag:{display:{Name:'{"text":"Gold Ingot","color":"gold","italic":false}'},undgold:1b}},sell:{id:"minecraft:netherite_pickaxe",Count:1b,tag:{display:{Name:'{"text":"Netherite Pickaxe","color":"yellow","italic":false}',Lore:['[{"text":"Base Mining Speed: ","color":"gray","italic":false},{"text":"9","color":"yellow"}]','{"text":" "}','{"text":"Efficiency X","color":"blue","italic":false}','[{"text":"Adds ","color":"gray","italic":false},{"text":"1 + (level ^ 2)","color":"yellow"},{"text":" mining speed."}]','{"text":" "}','[{"text":""},{"text":"Unbreaking X","color":"blue","italic":false}]','[{"text":"Makes the tool on average ","color":"gray","italic":false},{"text":"+100%","color":"green"}]','[{"text":""},{"text":"more durable per enchantment level.","color":"gray","italic":false}]']},HideFlags:39,Unbreakable:1b,pickaxe:1b,unditem:1b,Enchantments:[{}]}}},{rewardExp:0b,maxUses:5,uses:0,buy:{id:"minecraft:gold_ingot",Count:2b,tag:{display:{Name:'{"text":"Gold Ingot","color":"gold","italic":false}'},undgold:1b}},sell:{id:"minecraft:arrow",Count:64b,tag:{unditem:1b,display:{Name:'{"text":"Arrow","color":"white","italic":false}'}}}},{rewardExp:0b,maxUses:3,uses:0,buy:{id:"minecraft:gold_ingot",Count:3b,tag:{display:{Name:'{"text":"Gold Ingot","color":"gold","italic":false}'},undgold:1b}},sell:{id:"minecraft:potion",Count:1b,tag:{unditem:1b,display:{Name:'{"text":"Blazing Potion","color":"gold","italic":false}',Lore:['{"text":"Instantly heats you up and","color":"gray","italic":false}','{"text":"restores healing functionality.","color":"gray","italic":false}']},HideFlags:32,hotpotion:1b,CustomPotionColor:16746496,Enchantments:[{}]}}}]}}
execute if entity @s[scores={dialoguetime=170}] run tellraw @a [{"text":"<"},{"text":"Undyne","color":"#03739C"},{"text":"> "},{"text":"Alright, listen here, punk!","color":"#03739C"}]
execute if entity @s[scores={dialoguetime=170}] as @e[type=armor_stand,tag=undhead] at @s run playsound custom.act2.undyne.speech master @a ~ ~ ~ 1000

execute if entity @s[scores={dialoguetime=175}] run tag @e[type=armor_stand,tag=undhead] remove stoplooking

execute if entity @s[scores={dialoguetime=220}] run stopsound @a master custom.act2.undyne.speech
execute if entity @s[scores={dialoguetime=230}] run tellraw @a [{"text":"<"},{"text":"Undyne","color":"#03739C"},{"text":"> "},{"text":"I love collecting weaponry and stuff,","color":"#03739C"}]
execute if entity @s[scores={dialoguetime=230}] as @e[type=armor_stand,tag=undhead] at @s run playsound custom.act2.undyne.speech master @a ~ ~ ~ 1000
execute if entity @s[scores={dialoguetime=260}] run stopsound @a master custom.act2.undyne.speech
execute if entity @s[scores={dialoguetime=260}] run tellraw @a [{"text":"<"},{"text":"Undyne","color":"#03739C"},{"text":"> "},{"text":"so I think we can make a little trade.","color":"#03739C"}]
execute if entity @s[scores={dialoguetime=260}] as @e[type=armor_stand,tag=undhead] at @s run playsound custom.act2.undyne.speech master @a ~ ~ ~ 1000
execute if entity @s[scores={dialoguetime=320}] run stopsound @a master custom.act2.undyne.speech

execute if entity @s[scores={dialoguetime=330..359}] if entity @a[team=p,scores={x=-54..-51,z=90..95},nbt={Inventory:[{tag:{hoverwand:1b}}]}] run scoreboard players set @s dialoguetime 362

execute if entity @s[scores={dialoguetime=360}] run tellraw @a [{"text":"<"},{"text":"Undyne","color":"#03739C"},{"text":"> "},{"text":"GET OVER HERE BEFORE I CHANGE MY MIND!","color":"#03739C"}]
execute if entity @s[scores={dialoguetime=360}] as @e[type=armor_stand,tag=undhead] at @s run playsound custom.act2.undyne.speech master @a ~ ~ ~ 1000

execute if entity @s[scores={dialoguetime=..399}] if entity @e[type=villager,tag=undyneshop,nbt={Offers:{Recipes:[{uses:1,sell:{id:"minecraft:gold_ingot",Count:10b,tag:{display:{Name:'{"text":"Gold Ingot","color":"gold","italic":false}'},undgold:1b}}}]}}] run function ttt:act2/undyne_sell_wand

execute if entity @a[nbt={Inventory:[{tag:{unditem:1b}}]},scores={x=-48..,z=90..}] run function ttt:act2/undyne_update_item